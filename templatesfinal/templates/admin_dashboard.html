{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}
{% block nav_links %}
<a href="/admin/dashboard">Dashboard</a>
<a href="/admin/logout" class="btn btn-outline" style="background:var(--danger);color:white">Logout</a>
{% endblock %}
{% block content %}
<style>
.admin-dashboard{padding:2rem 0;background:white;min-height:80vh}
.admin-header{background:linear-gradient(135deg,var(--danger),#dc2626);color:white;padding:2rem;border-radius:16px;margin-bottom:2rem}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}
.stat-box{padding:1.5rem;border-radius:12px;text-align:center;color:white}
.stat-box h3{font-size:2.5rem;margin-bottom:0.5rem}
.data-section{background:white;padding:2rem;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.1);margin-bottom:2rem}
.table-container{overflow-x:auto;margin-top:1rem}
table{width:100%;border-collapse:collapse}
th,td{padding:1rem;text-align:left;border-bottom:1px solid #e2e8f0}
th{background:var(--gray-light);font-weight:600;color:var(--dark)}
tr:hover{background:#f8fafc}
.action-btn{padding:0.4rem 0.8rem;border:none;border-radius:6px;cursor:pointer;font-size:0.85rem;margin:0 0.2rem}
.btn-delete{background:var(--danger);color:white}
.btn-view{background:var(--primary);color:white}
</style>
<div class="container">
<div class="admin-dashboard">
<div class="admin-header"><h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1><p>Manage users, view analytics, and system statistics</p></div>
<div class="stats-grid">
<div class="stat-box" style="background:linear-gradient(135deg,#6366f1,#4f46e5)"><h3>{{stats.total_users}}</h3><p>Total Users</p></div>
<div class="stat-box" style="background:linear-gradient(135deg,#10b981,#059669)"><h3>{{stats.total_predictions}}</h3><p>Predictions Made</p></div>
<div class="stat-box" style="background:linear-gradient(135deg,#f59e0b,#d97706)"><h3>{{stats.total_colleges}}</h3><p>Colleges in DB</p></div>
<div class="stat-box" style="background:linear-gradient(135deg,#ec4899,#db2777)"><h3>{{stats.recent_users}}</h3><p>New Users (7d)</p></div>
</div>
<div class="data-section">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
<h2><i class="fas fa-users"></i> Recent Users</h2>
<a href="/admin/export_report" class="btn btn-primary"><i class="fas fa-download"></i> Export Report</a>
</div>
<div class="table-container"><table><thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Registered</th><th>Last Login</th><th>Actions</th></tr></thead>
<tbody>{% for user in recent_users %}<tr><td>{{user.id}}</td><td>{{user.name}}</td><td>{{user.email}}</td><td>{{user.created_at}}</td><td>{{user.last_login or 'Never'}}</td>`
<td><button class="action-btn btn-delete" data-user-id="{{user.id}}"><i class="fas fa-trash"></i> Delete</button></td></tr>{% endfor %}</tbody></table></div>
</div>
<div class="data-section">
<h2><i class="fas fa-chart-line"></i> Recent Predictions</h2>
<div class="table-container"><table><thead><tr><th>ID</th><th>User</th><th>Rank</th><th>Category</th><th>Date</th></tr></thead>
<tbody>{% for pred in recent_predictions %}<tr><td>{{pred.id}}</td><td>{{pred.email or 'Guest'}}</td><td>{{pred.rank}}</td><td>{{pred.category}}</td><td>{{pred.prediction_date}}</td></tr>{% endfor %}</tbody></table></div>
</div>
</div>
</div>
<script>
// Attach event listeners to delete buttons
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.btn-delete').forEach(button => {
        button.addEventListener('click', async function() {
            const userId = this.getAttribute('data-user-id');
            if(!confirm('Are you sure you want to delete this user?')) return;
            
            try {
                const res = await fetch(`/admin/users/${userId}/delete`, {method: 'POST'});
                const result = await res.json();
                if(result.success) {
                    alert('User deleted successfully');
                    location.reload();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch(e) {
                alert('Error: ' + e.message);
            }
        });
    });
});
</script>
{% endblock %}